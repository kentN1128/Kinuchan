{% extends 'base.html' %}

{% block main %}
<div class="container mt-6 px-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10">
      <div class="card shadow-sm border-light rounded-4">
        <div class="card-body p-4">

          <h2 class="fw-bold mb-4 text-center">ğŸ›’ ã‚«ãƒ¼ãƒˆ</h2>

          {% if object_list|length != 0 %}
          <div class="table-responsive">
            <table class="table table-bordered align-middle text-center">
              <thead class="table-light">
                <tr>
                  <th>#</th>
                  <th>å“å</th>
                  <th>å˜ä¾¡</th>
                  <th>å€‹æ•°</th>
                  <th>å°è¨ˆ</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                {% for object in object_list %}
                <tr>
                  <td>No.{{ forloop.counter }}</td>
                  <td>{{ object.name }}</td>
                  <td>Â¥{{ object.price }}</td>
                  <td>{{ object.quantity }}</td>
                  <td>Â¥{{ object.subtotal }}</td>
                  <td>
                    <a href="/cart/remove/{{ object.pk }}/" class="btn btn-sm btn-outline-danger">å‰Šé™¤</a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- åˆè¨ˆé‡‘é¡ -->
          <div class="text-end my-4">
            <p class="fs-5">å°è¨ˆï¼š<span class="fw-bold">Â¥{{ total }}</span></p>
            <p class="fs-5">ç¨è¾¼åˆè¨ˆï¼š<span class="fw-bold text-success">Â¥{{ tax_included_total }}</span></p>
          </div>

          <!-- Checkoutãƒœã‚¿ãƒ³ -->
          <form action="/pay/checkout/" method="POST" class="text-end">
            {% csrf_token %}
            <button type="submit" class="btn btn-success px-4 py-2 rounded-pill shadow-sm">ãƒ¬ã‚¸ã«é€²ã‚€</button>
          </form>

          {% else %}
          <p class="text-center fs-5">ğŸ› ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆã«å•†å“ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
          {% endif %}

        </div>
      </div>
    </div>
  </div>

  <!-- ãŠã™ã™ã‚ã‚¢ã‚¤ãƒ†ãƒ  -->
  <div class="mt-5">
    <h3 class="mb-3 fw-bold text-center">ğŸ” ã‚ãªãŸã¸ã®ãŠã™ã™ã‚</h3>
    <div class="row">
      {% for object in ADDITIONAL_ITEMS %}
      <div class="col-6 col-md-4 col-lg-3 my-2">
        {% include 'snippets/item_add_box.html' %}
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒã‚¯å¯¾å¿œ -->
<script>
  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
      window.location = "/pay/cancel/";
    }
  }, false);
</script>
{% endblock %}
